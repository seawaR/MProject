---
title: "Categorical Sequence Analysis with Optimal Matching: An Application with Data from the 'Women 40+ Healthy Aging Study'"
author: 'Adriana Clavijo Daza'
date: 'June 2023'
institution: 'University of Bern'
division: 'Faculty of Science'
advisor: 'Prof. Dr. David Ginsbourger'
altadvisor: 'Dr. Serena Lozza-Fiacco'
department: 'Institute of Mathematical Statistics and Actuarial Science'
degree: 'Master of Science in Statistics and Data Science'
knit: bookdown::render_book
# site: bookdown::bookdown_site

# The next two lines allow you to change the spacing in your thesis. You can 
# switch out \onehalfspacing with \singlespacing or \doublespacing, if desired.
header-includes:
    - \usepackage{setspace}\onehalfspacing
    - \usepackage{algpseudocode}
    - \usepackage{algorithm}
    - \AtBeginDocument{\renewcommand{\chaptername}{Section}}

# Remove the hashtag to specify which version of output you would like.
# Can only choose one at a time.
output:
  thesisdown::thesis_pdf: default 
#  thesisdown::thesis_gitbook: default         
#  thesisdown::thesis_word: default
#  thesisdown::thesis_epub: default

# If you are creating a PDF you'll need to write your preliminary content 
# (e.g., abstract, acknowledgements) below or use code similar to line 25-26 
# for the .RMD files. If you are NOT producing a PDF, delete or silence
# lines 25-39 in this YAML header.
abstract: |
  `r if(knitr:::is_latex_output()) paste(readLines("prelims/00-abstract.Rmd"), collapse = "\n  ")`

# If you'd rather include the preliminary content in files instead of inline
# like below, use a command like that for the abstract above.  Note that a tab 
# is needed on the line after the `|`.
acknowledgements: |
  I want to thank a few people.
dedication: |
  You can have a dedication here if you wish. 

# Note that abbreviations in lowercase letters will NOT be automatically
# capitalized.
# abbreviations:
#   ABC: American Broadcasting Company
#   CBS: Colombia Broadcasting System
#   CUS: Computer User Services
#   PBS: Public Broadcasting System
#   NBC: National Broadcasting Company

# Specify the location of the bibliography below
bibliography: bib/thesis.bib

# Download your specific csl file and refer to it in the line below.
csl: csl/apa.csl
lot: true
lof: true
---

<!--
Above is the YAML (YAML Ain't Markup Language) header that includes a lot of 
metadata used to produce the document.  Be careful with spacing in this header!

If you'd prefer to not include a Dedication, for example, simply delete the 
section entirely, or silence them (add # before each line). 

If you have other LaTeX packages you would like to include, delete the # before
header-includes and list the packages after hyphens on new lines.

If you'd like to include a comment that won't be produced in your resulting file
enclose it in a block like this.

If you receive a duplicate label error after knitting, make sure to delete the
index.Rmd file and then knit again.
-->

```{r packages, include = FALSE}
library(readxl)
library(tidyr)
library(dplyr)
library(stringr)
library(ggplot2)
library(TraMineR)
library(TraMineRextras)
library(cluster)
library(extrafont)
```

```{r helpers, include = FALSE}
## Note: this is order dependent.
source("helpers/distance_matrix.R", local = knitr::knit_global())
source("helpers/predict_scores.R", local = knitr::knit_global())
source("helpers/get_MSE.R", local = knitr::knit_global())
```

```{r setup, include = FALSE}
# Global knitr chunk options
## Note: updating global chunk options propagates, invalidating existing cache.
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE,
  # Graphics settings
  fig.align = "center",
  fig.width = 7.5,
  fig.height = 5.25,
  ## Use cairo_pdf to embed fonts in the plots (and preserve it when rendering):
  ## https://stackoverflow.com/a/36663975
  dev = "cairo_pdf",
  ## Font family for base plots. Requires it available via extrafont::
  dev.args = list(family = "Latin Modern Math") ## For base plots.
)

extrafont::loadfonts(device = "all")
# GGplot theme.
ggplot2::theme_set(ggplot2::theme_minimal(base_size = 12))

ggplot2::theme_update(
  ## Default axis labels size is 80% of plot font size. Increasing to 100%.
  axis.text = ggplot2::element_text(size = ggplot2::rel(1)),
  ## Font family. Requires it available via extrafont::
  text = ggplot2::element_text(family = "Latin Modern Math")
)

options(width = 80)
```

<!--
The acknowledgments, preface, dedication, and abstract are added into the PDF
version automatically by inputting them in the YAML at the top of this file.
Alternatively, you can put that content in files like 00--prelim.Rmd and
00-abstract.Rmd like done below.
-->

```{r eval = !knitr::is_latex_output(), child = here::here("prelims", "00--prelim.Rmd")}
```

```{r eval = !knitr::is_latex_output(), child = here::here("prelims", "00-abstract.Rmd")}
```

```{r, child = "data_prep.Rmd"}
```

```{r, child = "main_analysis.Rmd"}
```

<!-- The {.unnumbered} option here means that the introduction will be 
"Chapter 0." You can also use {-} for no numbers on chapters.
-->

# Introduction {.unnumbered}

In order to extract useful information from a dataset of categorical sequences, we can obtain pair-wise distances between the data points and use a distance-based method which is particularly useful when dealing with complex data types. Depending on the objective of the researcher and the availability of other observed variables, we can apply an unsupervised or supervised learning technique. For example, we can obtain groups of similar sequences, identify common trajectories or predict other variables of interst. 

In computational linguistics, we encounter several methods to obtain these distances, for instance, there is a category of measures known as *edit distances* that are widely used for text prediction. To give some examples, the Hamming distance accounts for differences at each time point or we can define a dissimilarity based on the length of common subsequences or prefixes. One of the measures considered as an edit distance is the Levenshtein distance which finds the minimum number of steps required to arrive to one sequence taking the other as a starting point. The steps can be insertion, deletions or substitutions in the case of the Levenshtein distance, but other distances also consider the option of character swaps. 

In bioinformatics, a generalization of the Levenshtein distance was proposed by @Needleman-Wunsch-1970 to find similarities in the amino acid sequences of two proteins. The Needleman-Wunsch algorithm finds the best alignment of two sequences by maximizing the similarity between them with the possibility of different penalization values for substitutions. This algorithm was introduction and adapted to social sciences by @Abbott-1986, who named it optimal matching (OM). Since then, it has been extensively used to answer questions involving sociological processes that take values in a categorical set and occur along a specific period of time, mainly in the study of paths of family formation or professional careers.

The common result of several studies employing OM is to find similarities and dissimilarities among categorical sequences and identify groups of trajectories that exhibit similar patterns. This is achieved through the application of clustering techniques to the distance matrix generated with help of the algorithm. However, there are a number of decisions involved in the application of OM, namely the method for calculation of the *cost matrix* or the normalization applied to the distances. We can see these decisions as hyperparameters that need to be tuned. 

In this work, we use a dataset that contains categorical sequences of the relationship history from the age of 15 years to the current age at the time of data collection for a group of women in the context. The sequences contain information about the civil status, relationship status, cohabitation status and presence or absence of children. The data was obtained as part of the 'Women 40+ Healthy Aging Study' which also encloses scores of personality traits that were obtained with a psychometric instrument. 

We explore then, the effect that changing the hyperparameters has on the distance matrix obtained via OM by considering how groups obtained via hierarchical clustering change and how the quality of the predictions of the personality scores is affected. 

For this purpose, we use the implementation of the OM algorithm in the `R` package `TraMineR` (@TraMineR) and the visualizations provided by `TraMineRextras`.

In Section \@ref(uno) we give an account of the most commonly used edit distances, then we introduce the data we use in out application, explain the method chosen for prediction and provide a detailed description of the optimal matching algorithm, including the methods considered to obtain the cost matrix and the normalization methods for the distance matrix. In Section \@ref(data), we provide more insight on the data and perform OM to obtain clusters of sequences and use visualizations to provide a description of the groups. In Section \@ref(knn), we describe perform a first attempt at prediction of the personality scores based on the data from the previous section and in Subsection \@ref(scenarios), we show some of the additional scenarios considered, specifically those that produce the best predictions for each personality trait. Finally, we present some conclusions and recommendations for future work.
