select(c(1, 58:106))
tst_se <- raw_data %>%
filter(`Start-1` > `End-1` |
`Start-2` > `End-2` |
`Start-3` > `End-3` |
`Start-4` > `End-4` |
`Start-5` > `End-5` |
`Start-6` > `End-6` |
`Start-7` > `End-7` |
`Start-8` > `End-8` |
`Start-9` > `End-9` |
`Start-10` > `End-10` |
`Start-11` > `End-11` |
`Start-12` > `End-12`)
tst_se
tst_over <- raw_data %>%
filter(`End-1` > `Start-2` |
`End-2` > `Start-3` |
`End-3` > `Start-4` |
`End-4` > `Start-5` |
`End-5` > `Start-6` |
`End-6` > `Start-7` |
`End-7` > `Start-8` |
`End-8` > `Start-9` |
`End-9` > `Start-10` |
`End-10` > `Start-11` |
`End-11` > `Start-12`)
tst_over
raw_data <- raw_data %>%
pivot_longer(cols = starts_with("Start"),
names_to = "Phase",
names_prefix = "Start-",
values_to = "Start_age",
values_drop_na = TRUE) %>%
pivot_longer(cols = starts_with("End"),
names_to = "Match2",
names_prefix = "End-",
values_to = "End_age",
values_drop_na = TRUE) %>%
pivot_longer(cols = starts_with("Civil"),
names_to = "Match3",
names_prefix = "Civil-",
values_to = "Civil_status",
values_drop_na = TRUE) %>%
pivot_longer(cols = starts_with("Relationship"),
names_to = "Match4",
names_prefix = "Relationship-",
values_to = "Relationship_status",
values_drop_na = TRUE) %>%
filter(Phase == Match2,
Phase == Match3,
Phase == Match4,
Start_age >= 15,
Id != c("zr34u", "EN61O"),
!(Id == "GB28U" & Phase == "4")) %>%
select(-contains("Match")) %>%
mutate(Civil_status = factor(Civil_status, levels = cs_levels, labels = cs_labels),
Relationship_status = factor(Relationship_status, levels = rs_levels, labels = rs_labels),
Phase = as.numeric(Phase))
raw_data <- read_excel(file)
raw_data <- raw_data %>%
select_if(~!all(is.na(.)))
colnames(raw_data)[1] <- "Id"
colnames(raw_data)[58] <- "Age"
colnames(raw_data)[59:82] <- new_names
colnames(raw_data)[83:94] <- paste0("Civil-", 1:12)
colnames(raw_data)[95:106] <- paste0("Relationship-", 1:12)
raw_data <- raw_data %>%
select(c(1, 58:106))
tst_se <- raw_data %>%
filter(`Start-1` > `End-1` |
`Start-2` > `End-2` |
`Start-3` > `End-3` |
`Start-4` > `End-4` |
`Start-5` > `End-5` |
`Start-6` > `End-6` |
`Start-7` > `End-7` |
`Start-8` > `End-8` |
`Start-9` > `End-9` |
`Start-10` > `End-10` |
`Start-11` > `End-11` |
`Start-12` > `End-12`)
tst_se
tst_over <- raw_data %>%
filter(`End-1` > `Start-2` |
`End-2` > `Start-3` |
`End-3` > `Start-4` |
`End-4` > `Start-5` |
`End-5` > `Start-6` |
`End-6` > `Start-7` |
`End-7` > `Start-8` |
`End-8` > `Start-9` |
`End-9` > `Start-10` |
`End-10` > `Start-11` |
`End-11` > `Start-12`)
tst_over
raw_data <- raw_data %>%
pivot_longer(cols = starts_with("Start"),
names_to = "Phase",
names_prefix = "Start-",
values_to = "Start_age",
values_drop_na = TRUE) %>%
pivot_longer(cols = starts_with("End"),
names_to = "Match2",
names_prefix = "End-",
values_to = "End_age",
values_drop_na = TRUE) %>%
pivot_longer(cols = starts_with("Civil"),
names_to = "Match3",
names_prefix = "Civil-",
values_to = "Civil_status",
values_drop_na = TRUE) %>%
pivot_longer(cols = starts_with("Relationship"),
names_to = "Match4",
names_prefix = "Relationship-",
values_to = "Relationship_status",
values_drop_na = TRUE) %>%
filter(Phase == Match2,
Phase == Match3,
Phase == Match4,
Start_age >= 15,
!Id %in% c("zr34u", "EN61O"),
!(Id == "GB28U" & Phase == "4")) %>%
select(-contains("Match")) %>%
mutate(Civil_status = factor(Civil_status, levels = cs_levels, labels = cs_labels),
Relationship_status = factor(Relationship_status, levels = rs_levels, labels = rs_labels),
Phase = as.numeric(Phase))
View(raw_data)
?seqsubm
tst <- raw_data %>%
mutate(
Status= case_when(
Relationship_status == "No relationship" & Civil_status == "Single" ~ 1,
Relationship_status %in% c("Relationship", "Open relationship") & Civil_status == "Single" ~ 2,
Relationship_status == "Changing relationships" & Civil_status == "Single" ~ 3,
Civil_status %in% c("Married", "Registered partnership") ~ 4,
Relationship_status == "No relationship" & Civil_status == "Divorced" ~ 5,
Relationship_status %in% c("Relationship", "Open relationship") & Civil_status == "Divorced" ~ 6,
Relationship_status == "Changing relationships" & Civil_status == "Divorced" ~ 7,
Relationship_status == "No relationship" & Civil_status == "Widowed" ~ 8,
Relationship_status %in% c("Relationship", "Open relationship") & Civil_status == "Widowed" ~ 9,
Relationship_status == "Changing relationships" & Civil_status == "Widowed" ~ 10,
TRUE ~ 0
)
)
# check no cases left out of consideration
tst %>% filter(Status == 0)
unique(tst$Status)
status_levels <- 1:10
status_labels <- c("Single",
"Relationship",
"Changing relationships",
"Married",
"Divorced",
"Divorced & relationship",
"Divorced & changing relationships",
"Widowed",
"Widowed & relationship",
"Widowed & changing relationships")
rh_data <- tst %>%
select(-Civil_status, -Relationship_status) %>%
mutate(Status_char = factor(Status, levels = status_levels, labels = status_labels))
test <- seqformat(rh_data, from = "SPELL", to = "STS",
id = "Id", begin = "Start_age", end = "End_age", status = "Status",
covar = "Age", process = FALSE)
alphabet <- as.character(1:10)
my_seq <- seqdef(test, alphabet = alphabet)
cost_matrix_1 <- seqsubm(my_seq, method = "TRATE")
cost_matrix_1 <- seqsubm(my_seq, method = "TRATE", proximities = TRUE)
readr::write_csv(cm, "../Output/prox_matrix1.csv")
cm <- cbind(status_labels, data.frame(cost_matrix_1))
colnames(cm) <- c("Status", status_labels)
print(cm, digits = 4)
cost_matrix_1 <- seqsubm(my_seq, method = "TRATE", proximities = TRUE)
cm <- cbind(status_labels, data.frame(cost_matrix_1))
colnames(cm) <- c("Status", status_labels)
print(cm, digits = 4)
cm
?seqsubm
cost_matrix_1 <- seqcost(my_seq, method = "TRATE", proximities = TRUE)
View(cost_matrix_1)
cm <- cbind(status_labels, data.frame(cost_matrix_1$prox))
colnames(cm) <- c("Status", status_labels)
print(cm, digits = 4)
readr::write_csv(cm, "../Output/prox_matrix1.csv")
cost_matrix_1 <- seqsubm(my_seq, method = "TRATE")
raw_data <- read_excel(file)
raw_data <- raw_data %>%
select_if(~!all(is.na(.)))
new_names <- vector(mode = "character")
for (i in 1:12){
new_names[2*(i-1)+1] <- paste0("Start-", i)
new_names[2*(i-1)+2] <- paste0("End-", i)
}
colnames(raw_data)[1] <- "Id"
colnames(raw_data)[58] <- "Age"
colnames(raw_data)[59:82] <- new_names
colnames(raw_data)[83:94] <- paste0("Civil-", 1:12)
colnames(raw_data)[95:106] <- paste0("Relationship-", 1:12)
raw_data <- raw_data %>%
select(c(1, 58:106))
tst_se <- raw_data %>%
filter(`Start-1` > `End-1` |
`Start-2` > `End-2` |
`Start-3` > `End-3` |
`Start-4` > `End-4` |
`Start-5` > `End-5` |
`Start-6` > `End-6` |
`Start-7` > `End-7` |
`Start-8` > `End-8` |
`Start-9` > `End-9` |
`Start-10` > `End-10` |
`Start-11` > `End-11` |
`Start-12` > `End-12`)
tst_se
tst_over <- raw_data %>%
filter(`End-1` > `Start-2` |
`End-2` > `Start-3` |
`End-3` > `Start-4` |
`End-4` > `Start-5` |
`End-5` > `Start-6` |
`End-6` > `Start-7` |
`End-7` > `Start-8` |
`End-8` > `Start-9` |
`End-9` > `Start-10` |
`End-10` > `Start-11` |
`End-11` > `Start-12`)
tst_over
raw_data <- raw_data %>%
pivot_longer(cols = starts_with("Start"),
names_to = "Phase",
names_prefix = "Start-",
values_to = "Start_age",
values_drop_na = TRUE) %>%
pivot_longer(cols = starts_with("End"),
names_to = "Match2",
names_prefix = "End-",
values_to = "End_age",
values_drop_na = TRUE) %>%
pivot_longer(cols = starts_with("Civil"),
names_to = "Match3",
names_prefix = "Civil-",
values_to = "Civil_status",
values_drop_na = TRUE) %>%
pivot_longer(cols = starts_with("Relationship"),
names_to = "Match4",
names_prefix = "Relationship-",
values_to = "Relationship_status",
values_drop_na = TRUE) %>%
filter(Phase == Match2,
Phase == Match3,
Phase == Match4,
Start_age >= 15,
!Id %in% c("zr34u", "EN61O"),
!(Id == "GB28U" & Phase == "4")) %>%
select(-contains("Match")) %>%
mutate(Civil_status = factor(Civil_status, levels = cs_levels, labels = cs_labels),
Relationship_status = factor(Relationship_status, levels = rs_levels, labels = rs_labels),
Phase = as.numeric(Phase))
plot1 <- ggplot(data = raw_data, aes(Civil_status))
plot1 + geom_bar() + geom_text(stat="count", aes(label=..count..), vjust=-1)
plot2 + geom_bar() + geom_text(stat="count", aes(label=..count..), vjust=-1)
ggplot(raw_data,
aes(x = Civil_status,
y = Start_age)) +
geom_boxplot()
plot2 <- ggplot(data = raw_data, aes(Relationship_status))
plot2 + geom_bar() + geom_text(stat="count", aes(label=..count..), vjust=-1)
tst <- raw_data %>%
mutate(
Status= case_when(
Relationship_status == "No relationship" & Civil_status == "Single" ~ 1,
Relationship_status %in% c("Relationship", "Open relationship") & Civil_status == "Single" ~ 2,
Relationship_status == "Changing relationships" & Civil_status == "Single" ~ 3,
Civil_status %in% c("Married", "Registered partnership") ~ 4,
Relationship_status == "No relationship" & Civil_status == "Divorced" ~ 5,
Relationship_status %in% c("Relationship", "Open relationship") & Civil_status == "Divorced" ~ 6,
Relationship_status == "Changing relationships" & Civil_status == "Divorced" ~ 7,
Relationship_status == "No relationship" & Civil_status == "Widowed" ~ 8,
Relationship_status %in% c("Relationship", "Open relationship") & Civil_status == "Widowed" ~ 9,
Relationship_status == "Changing relationships" & Civil_status == "Widowed" ~ 10,
TRUE ~ 0
)
)
# check no cases left out of consideration
tst %>% filter(Status == 0)
unique(tst$Status)
status_levels <- 1:10
status_labels <- c("Single",
"Relationship",
"Changing relationships",
"Married",
"Divorced",
"Divorced & relationship",
"Divorced & changing relationships",
"Widowed",
"Widowed & relationship",
"Widowed & changing relationships")
rh_data <- tst %>%
select(-Civil_status, -Relationship_status) %>%
mutate(Status_char = factor(Status, levels = status_levels, labels = status_labels))
plot3 <- ggplot(data = rh_data, aes(Status_char))
plot3 + geom_bar() + geom_text(stat="count", aes(label=..count..), vjust=-1) + scale_x_discrete(guide = guide_axis(n.dodge=2))
library(readxl)
library(tidyr)
library(dplyr)
library(stringr)
library(ggplot2)
library(TraMineR)
cs_levels <- 1:6
cs_labels <- c("Single", "Married", "Registered partnership",
"Same-sex partnership", "Divorced", "Widowed")
rs_levels <- 1:4
rs_labels <- c("No relationship", "Relationship",
"Open relationship", "Changing relationships")
file <- "../Data_original/Tracker_Uni-Zurich_Modified.xlsx"
raw_data <- read_excel(file)
raw_data <- raw_data %>%
select_if(~!all(is.na(.)))
new_names <- vector(mode = "character")
for (i in 1:12){
new_names[2*(i-1)+1] <- paste0("Start-", i)
new_names[2*(i-1)+2] <- paste0("End-", i)
}
colnames(raw_data)[1] <- "Id"
colnames(raw_data)[58] <- "Age"
colnames(raw_data)[59:82] <- new_names
colnames(raw_data)[83:94] <- paste0("Civil-", 1:12)
colnames(raw_data)[95:106] <- paste0("Relationship-", 1:12)
raw_data <- raw_data %>%
select(c(1, 58:106))
tst_se <- raw_data %>%
filter(`Start-1` > `End-1` |
`Start-2` > `End-2` |
`Start-3` > `End-3` |
`Start-4` > `End-4` |
`Start-5` > `End-5` |
`Start-6` > `End-6` |
`Start-7` > `End-7` |
`Start-8` > `End-8` |
`Start-9` > `End-9` |
`Start-10` > `End-10` |
`Start-11` > `End-11` |
`Start-12` > `End-12`)
tst_se
tst_over <- raw_data %>%
filter(`End-1` > `Start-2` |
`End-2` > `Start-3` |
`End-3` > `Start-4` |
`End-4` > `Start-5` |
`End-5` > `Start-6` |
`End-6` > `Start-7` |
`End-7` > `Start-8` |
`End-8` > `Start-9` |
`End-9` > `Start-10` |
`End-10` > `Start-11` |
`End-11` > `Start-12`)
tst_over
raw_data <- raw_data %>%
pivot_longer(cols = starts_with("Start"),
names_to = "Phase",
names_prefix = "Start-",
values_to = "Start_age",
values_drop_na = TRUE) %>%
pivot_longer(cols = starts_with("End"),
names_to = "Match2",
names_prefix = "End-",
values_to = "End_age",
values_drop_na = TRUE) %>%
pivot_longer(cols = starts_with("Civil"),
names_to = "Match3",
names_prefix = "Civil-",
values_to = "Civil_status",
values_drop_na = TRUE) %>%
pivot_longer(cols = starts_with("Relationship"),
names_to = "Match4",
names_prefix = "Relationship-",
values_to = "Relationship_status",
values_drop_na = TRUE) %>%
filter(Phase == Match2,
Phase == Match3,
Phase == Match4,
Start_age >= 15,
!Id %in% c("zr34u", "EN61O"),
!(Id == "GB28U" & Phase == "4")) %>%
select(-contains("Match")) %>%
mutate(Civil_status = factor(Civil_status, levels = cs_levels, labels = cs_labels),
Relationship_status = factor(Relationship_status, levels = rs_levels, labels = rs_labels),
Phase = as.numeric(Phase))
tst <- raw_data %>%
mutate(
Status= case_when(
Relationship_status == "No relationship" & Civil_status == "Single" ~ 1,
Relationship_status %in% c("Relationship", "Open relationship") & Civil_status == "Single" ~ 2,
Relationship_status == "Changing relationships" & Civil_status == "Single" ~ 3,
Civil_status %in% c("Married", "Registered partnership") ~ 4,
Relationship_status == "No relationship" & Civil_status == "Divorced" ~ 1,
Relationship_status %in% c("Relationship", "Open relationship") & Civil_status == "Divorced" ~ 2,
Relationship_status == "Changing relationships" & Civil_status == "Divorced" ~ 3,
Relationship_status == "No relationship" & Civil_status == "Widowed" ~ 1,
Relationship_status %in% c("Relationship", "Open relationship") & Civil_status == "Widowed" ~ 2,
Relationship_status == "Changing relationships" & Civil_status == "Widowed" ~ 3,
TRUE ~ 0
)
)
# check no cases left out of consideration
tst %>% filter(Status == 0)
unique(tst$Status)
status_levels <- 1:4
status_labels <- c("No relationship",
"Relationship",
"Changing relationships",
"Married")
rh_data <- tst %>%
select(-Civil_status, -Relationship_status) %>%
mutate(Status_char = factor(Status, levels = status_levels, labels = status_labels))
plot3 <- ggplot(data = rh_data, aes(Status_char))
plot3 + geom_bar() + geom_text(stat="count", aes(label=..count..), vjust=-1) + scale_x_discrete(guide = guide_axis(n.dodge=2))
test <- seqformat(rh_data, from = "SPELL", to = "STS",
id = "Id", begin = "Start_age", end = "End_age", status = "Status",
covar = "Age", process = FALSE)
alphabet <- as.character(1:4)
my_seq <- seqdef(test, alphabet = alphabet)
cost_matrix_1 <- seqsubm(my_seq, method = "TRATE")
cm <- cbind(status_labels, data.frame(cost_matrix_1))
colnames(cm) <- c("Status", status_labels)
print(cm, digits = 4)
readr::write_csv(cm, "cost_matrix2.csv")
readr::write_csv(cm, "../Output/cost_matrix2.csv")
library(foreign)
library(readxl)
library(dplyr)
sav_file <- "../Data_original/Datensatz_gesamt.sav"
full_db <- read.spss(sav_file, to.data.frame=TRUE)
xl_file <- "../Data_original/Base_MA_Adriana.xls"
sub_data <- read_excel(xl_file)
data <- full_db %>%
select(colnames(sub_data))
View(data)
View(data)
plot(data)
plot(data)
library(ggplot2)
ggplot(data, aes(GermanSkills)) +
geom_bar()
ggplot(data, aes(SomDisease)) +
geom_bar()
ggplot(data, aes(Psychotherapie)) +
geom_bar()
ggplot(data, aes(Psychotherapy)) +
geom_bar()
ggplot(data, aes(Drugs)) +
geom_bar()
ggplot(data, aes(Menstruation_Letzte12)) +
geom_bar()
ggplot(data, aes(Menstruation_Letzte12)) +
geom_bar() + geom_text(stat="count", aes(label=..count..), vjust=-1) + scale_x_discrete(guide = guide_axis(n.dodge=2))
summary(data$Menstruation_Letzte12)
summary(data$Menstruation_Letzte3)
ggplot(data, aes(Menstruation_Letzte3)) +
geom_bar() + geom_text(stat="count", aes(label=..count..), vjust=-1) + scale_x_discrete(guide = guide_axis(n.dodge=2))
data <- full_db %>%
select(colnames(sub_data)) %>%
mutate(MensMenopaus = ifelse(MensMenopaus == -66, NA, MensMenopaus))
summary(data$MenMenopaus)
data <- full_db %>%
select(colnames(sub_data)) %>%
mutate(MensMenopaus = ifelse(MensMenopaus == -66, NA, MensMenopaus))
summary(data$MenMenopaus)
ggplot(data, aes(Menstruation_Letzte3)) +
geom_histogram()
ggplot(data, aes(Menstruation_Letzte3)) +
geom_histogram(stat = "count")
ggplot(data, aes(MensMenopaus)) +
geom_histogram()
View(data)
colnames(data)
unique(data$Country_Residence)
summary(data$Country_Residence)
summary(data)
summary(as.factor(data$Country_Residence))
data <- full_db %>%
select(colnames(sub_data)) %>%
mutate(MensMenopaus = ifelse(MensMenopaus == -66, NA, MensMenopaus),
Nationality = case_when(
Swiss == "quoted" ~ "Swiss",
G_A_FL_L == "quoted",
Europe == "quoted"
))
data <- full_db %>%
select(colnames(sub_data)) %>%
mutate(MensMenopaus = ifelse(MensMenopaus == -66, NA, MensMenopaus),
Nationality = case_when(
Swiss == "quoted" ~ "Swiss",
G_A_FL_L == "quoted" ~ "GER/AUT/LIE/LUX",
Europe == "quoted" ~ "Other european country"
))
ggplot(data, aes(Nationality)) +
geom_bar() + geom_text(stat="count", aes(label=..count..), vjust=-1) + scale_x_discrete(guide = guide_axis(n.dodge=2))
summary(data$Menstruation_Letzte12)
ggplot(data, aes(Menstruation_Letzte12)) +
geom_bar() + geom_text(stat="count", aes(label=..count..), vjust=-1) + scale_x_discrete(guide = guide_axis(n.dodge=2))
summary(data$Menstruation_Letzte3)
ggplot(data, aes(Menstruation_Letzte3)) +
geom_bar() + geom_text(stat="count", aes(label=..count..), vjust=-1) + scale_x_discrete(guide = guide_axis(n.dodge=2))
ggplot(data, aes(Nationality)) +
geom_bar() + geom_text(stat="count", aes(label=..count..), vjust=-1) + scale_x_discrete(guide = guide_axis(n.dodge=2))
ggplot(data, aes(MensMenopaus)) +
geom_histogram()
400/12
data %>% filter(MensMenopaus>400)
300/12
